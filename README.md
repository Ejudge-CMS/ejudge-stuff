# Ejudge-контейнер: some stuff

## Контейнер изолированного запуска

Модифицированная версия контейнера для запуска недоверенных программ, написанная А.Черновым для тестирующей системы [Ejudge](https://ejudge.ru).

### Инсталляция

Клонируйте репозиторий, зайдите в папку **container** и запустите установочный скрипт **setup.sh** от пользователя **root**.

### Использование

См. [инструкцию](https://ejudge.ru/wiki/index.php/Ej-suid-container). ЗАПЯТУЮ ПЕРЕД ПУТЁМ СТАВИТЬ НЕ НАДО! Также были выкинуты опции mo, mp, mg, mG, mC.

## Двойной запуск

#### Использование

Также написан заголовочный файл **start.c**, предоставляющие возможность фильтрации системных вызовов. Для использования необходимо _отключить_ фильтрацию системных вызовов (опция **s0**) во встроенном контейнере, и заполнить соответствующие функции в коде файла **template.c**:

1. **process_input** - читает из входного файла, выводит на вход первому запуску
2. **process_first_run** - читает из вывода первого запуска, выводит на вывод второму запуску
3. **process_final** - читает из вывода второго запуска, выводит в выходной файл, доступный чекеру.

После любого чтения строку НЕ переводить, после любой записи строку НАДО переводить.

Далее необходимо скомпилировать:

```console
gcc /path/to/start.c /path/to/template.c -D'INPUTFILE="<input file name>"' -o start
```

<input file name> - имя файла со входными данными (по умолчанию input). Скрипт его будет удалять перед запуском программмы участника.

Полученный файл **start** необходимо вписать как **start_cmd** в конфиг задачи.

#### Ограничения

Размер входных и выходных данных ограничен максимальным размером pipe (для непривелегированных процессов - 1048576).
